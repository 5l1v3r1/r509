<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=en_us" />
<title>
  Class: R509::Ocsp::Helper::ResponseSigner
  
    &mdash; Documentation by YARD 0.7.4
  
</title>

  <link rel="stylesheet" href="../../../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../../..';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../../_index.html">Index (R)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../../../R509.html" title="R509 (module)">R509</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Ocsp.html" title="R509::Ocsp (module)">Ocsp</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Helper.html" title="R509::Ocsp::Helper (module)">Helper</a></span></span>
     &raquo; 
    <span class="title">ResponseSigner</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: R509::Ocsp::Helper::ResponseSigner
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">R509::Ocsp::Helper::ResponseSigner</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/r509/Ocsp.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>signs OCSP responses</p>


  </div>
</div>
<div class="tags">
  

</div>




  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (ResponseSigner) <strong>initialize</strong>(options) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>A new instance of ResponseSigner.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sign_response-instance_method" title="#sign_response (instance method)">- (OpenSSL::OCSP::OCSPResponse) <strong>sign_response</strong>(request_data) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Signs response.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="R509::Ocsp::Helper::ResponseSigner (class)">ResponseSigner</a></span></tt>) <strong>initialize</strong>(options) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>A new instance of ResponseSigner</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>a customizable set of options</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <h3>Options Hash (<tt>options</tt>):</h3>
    <ul class="option">
      
        <li>
          <span class="name">:copy_nonce</span>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="default">
            
          </span>
          
        </li>
      
        <li>
          <span class="name">:configs</span>
          <span class="type">(<tt>Array&lt;<span class='object_link'><a href="../../Config/CaConfig.html" title="R509::Config::CaConfig (class)">R509::Config::CaConfig</a></span>&gt;</tt>)</span>
          <span class="default">
            
          </span>
          
        </li>
      
    </ul>
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


168
169
170
171
172
173
174
175
176
177
178
179
180
181
182</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/r509/Ocsp.rb', line 168</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='rubyid_options identifier id'>options</span><span class='rparen token'>)</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_options identifier id'>options</span><span class='dot token'>.</span><span class='rubyid_has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='symbol val'>:copy_nonce</span><span class='rparen token'>)</span>
        <span class='rubyid_@copy_nonce ivar id'>@copy_nonce</span> <span class='assign token'>=</span> <span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:copy_nonce</span><span class='rbrack token'>]</span>
    <span class='rubyid_else else kw'>else</span>
        <span class='rubyid_@copy_nonce ivar id'>@copy_nonce</span> <span class='assign token'>=</span> <span class='rubyid_false false kw'>false</span>
    <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_@configs ivar id'>@configs</span> <span class='assign token'>=</span> <span class='rubyid_options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:configs</span><span class='rbrack token'>]</span>
    <span class='rubyid_unless unless kw'>unless</span> <span class='rubyid_@configs ivar id'>@configs</span><span class='dot token'>.</span><span class='rubyid_kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='rubyid_Array constant id'>Array</span><span class='rparen token'>)</span>
        <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_R509 constant id'>R509</span><span class='colon2 op'>::</span><span class='rubyid_R509Error constant id'>R509Error</span><span class='comma token'>,</span> <span class='string val'>&quot;Must pass an array of R509::Config objects&quot;</span>
    <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_@configs ivar id'>@configs</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>
        <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_R509 constant id'>R509</span><span class='colon2 op'>::</span><span class='rubyid_R509Error constant id'>R509Error</span><span class='comma token'>,</span> <span class='string val'>&quot;Must be at least one R509::Config object&quot;</span>
    <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_@default_config ivar id'>@default_config</span> <span class='assign token'>=</span> <span class='rubyid_@configs ivar id'>@configs</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="sign_response-instance_method">
  
    - (<tt>OpenSSL::OCSP::OCSPResponse</tt>) <strong>sign_response</strong>(request_data) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Signs response. Only call this after loading a request or adding your own status</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>request_data</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>of { :parsed_request, :statuses }</p>
</div>
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>OpenSSL::OCSP::OCSPResponse</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/r509/Ocsp.rb', line 188</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_sign_response identifier id'>sign_response</span><span class='lparen token'>(</span><span class='rubyid_request_data identifier id'>request_data</span><span class='rparen token'>)</span>
    <span class='rubyid_basic_response identifier id'>basic_response</span> <span class='assign token'>=</span> <span class='rubyid_OpenSSL constant id'>OpenSSL</span><span class='colon2 op'>::</span><span class='rubyid_OCSP constant id'>OCSP</span><span class='colon2 op'>::</span><span class='rubyid_BasicResponse constant id'>BasicResponse</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span>

    <span class='rubyid_basic_response identifier id'>basic_response</span><span class='dot token'>.</span><span class='rubyid_copy_nonce identifier id'>copy_nonce</span><span class='lparen token'>(</span><span class='rubyid_request_data identifier id'>request_data</span><span class='lbrack token'>[</span><span class='symbol val'>:parsed_request</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_@copy_nonce ivar id'>@copy_nonce</span>

    <span class='rubyid_has_invalid identifier id'>has_invalid</span> <span class='assign token'>=</span> <span class='rubyid_false false kw'>false</span>
    <span class='rubyid_config identifier id'>config</span> <span class='assign token'>=</span> <span class='rubyid_nil nil kw'>nil</span>
    <span class='rubyid_request_data identifier id'>request_data</span><span class='lbrack token'>[</span><span class='symbol val'>:statuses</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_status identifier id'>status</span><span class='bitor op'>|</span>
        <span class='rubyid_if if kw'>if</span> <span class='rubyid_status identifier id'>status</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span> <span class='rubyid_or or kw'>or</span> <span class='rubyid_status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:config</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span>
            <span class='rubyid_has_invalid identifier id'>has_invalid</span> <span class='assign token'>=</span> <span class='rubyid_true true kw'>true</span>
        <span class='rubyid_else else kw'>else</span>
            <span class='rubyid_if if kw'>if</span> <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span>
                <span class='rubyid_config identifier id'>config</span> <span class='assign token'>=</span> <span class='rubyid_status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:config</span><span class='rbrack token'>]</span>
            <span class='rubyid_end end kw'>end</span>
            <span class='rubyid_if if kw'>if</span> <span class='rubyid_config identifier id'>config</span> <span class='neq op'>!=</span> <span class='rubyid_status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:config</span><span class='rbrack token'>]</span>
                <span class='rubyid_has_invalid identifier id'>has_invalid</span> <span class='assign token'>=</span> <span class='rubyid_true true kw'>true</span>
            <span class='rubyid_end end kw'>end</span>

            <span class='rubyid_basic_response identifier id'>basic_response</span><span class='dot token'>.</span><span class='rubyid_add_status identifier id'>add_status</span><span class='lparen token'>(</span><span class='rubyid_status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:certid</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
                                    <span class='rubyid_status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:status</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
                                    <span class='rubyid_status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:revocation_reason</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
            <span class='comment val'>#TODO: WHY IN THE HELL IS REVOCATION TIME RELATIVE TO NOW? THAT CAN'T BE RIGHT!</span>
                                    <span class='rubyid_status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:revocation_time</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
                                    <span class='integer val'>-1</span><span class='mult op'>*</span><span class='rubyid_status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:config</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_ocsp_start_skew_seconds identifier id'>ocsp_start_skew_seconds</span><span class='comma token'>,</span>
                                    <span class='rubyid_status identifier id'>status</span><span class='lbrack token'>[</span><span class='symbol val'>:config</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_ocsp_validity_hours identifier id'>ocsp_validity_hours</span><span class='mult op'>*</span><span class='integer val'>3600</span><span class='comma token'>,</span>
                                    <span class='lbrack token'>[</span><span class='rbrack token'>]</span> <span class='comment val'>#array of OpenSSL::X509::Extensions</span>
                                    <span class='rparen token'>)</span>
        <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_has_invalid identifier id'>has_invalid</span>
        <span class='rubyid_response_status identifier id'>response_status</span> <span class='assign token'>=</span> <span class='rubyid_OpenSSL constant id'>OpenSSL</span><span class='colon2 op'>::</span><span class='rubyid_OCSP constant id'>OCSP</span><span class='colon2 op'>::</span><span class='rubyid_RESPONSE_STATUS_UNAUTHORIZED constant id'>RESPONSE_STATUS_UNAUTHORIZED</span>
    <span class='rubyid_else else kw'>else</span>
        <span class='rubyid_response_status identifier id'>response_status</span> <span class='assign token'>=</span> <span class='rubyid_OpenSSL constant id'>OpenSSL</span><span class='colon2 op'>::</span><span class='rubyid_OCSP constant id'>OCSP</span><span class='colon2 op'>::</span><span class='rubyid_RESPONSE_STATUS_SUCCESSFUL constant id'>RESPONSE_STATUS_SUCCESSFUL</span>
    <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span>
        <span class='rubyid_config identifier id'>config</span> <span class='assign token'>=</span> <span class='rubyid_@default_config ivar id'>@default_config</span>
    <span class='rubyid_end end kw'>end</span>
    <span class='comment val'>#confusing, but R509::Cert contains R509::PrivateKey under #key. PrivateKey#key gives the OpenSSL object</span>
    <span class='rubyid_basic_response identifier id'>basic_response</span><span class='dot token'>.</span><span class='rubyid_sign identifier id'>sign</span><span class='lparen token'>(</span><span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_ocsp_cert identifier id'>ocsp_cert</span><span class='dot token'>.</span><span class='rubyid_cert identifier id'>cert</span><span class='comma token'>,</span><span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_ocsp_cert identifier id'>ocsp_cert</span><span class='dot token'>.</span><span class='rubyid_key identifier id'>key</span><span class='dot token'>.</span><span class='rubyid_key identifier id'>key</span><span class='comma token'>,</span><span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_ocsp_chain identifier id'>ocsp_chain</span><span class='rparen token'>)</span>

    <span class='comment val'>#turns out BasicResponse#sign can take up to 4 params</span>
    <span class='comment val'>#cert</span>
    <span class='comment val'>#key</span>
    <span class='comment val'>#array of OpenSSL::X509::Certificates</span>
    <span class='comment val'>#flags (not sure what the enumeration of those are)</span>

    <span class='comment val'># first arg is the response status code, comes from this list</span>
    <span class='comment val'># these can also be enumerated via OpenSSL::OCSP::RESPONSE_STATUS_*</span>
    <span class='comment val'>#OCSPResponseStatus ::= ENUMERATED {</span>
    <span class='comment val'>#    successful            (0),      --Response has valid confirmations</span>
    <span class='comment val'>#    malformedRequest      (1),      --Illegal confirmation request</span>
    <span class='comment val'>#    internalError         (2),      --Internal error in issuer</span>
    <span class='comment val'>#    tryLater              (3),      --Try again later</span>
    <span class='comment val'>#                       --(4) is not used</span>
    <span class='comment val'>#    sigRequired           (5),      --Must sign the request</span>
    <span class='comment val'>#    unauthorized          (6)       --Request unauthorized</span>
    <span class='comment val'>#}</span>
    <span class='comment val'>#</span>
    <span class='rubyid_R509 constant id'>R509</span><span class='colon2 op'>::</span><span class='rubyid_Ocsp constant id'>Ocsp</span><span class='colon2 op'>::</span><span class='rubyid_Response constant id'>Response</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_OpenSSL constant id'>OpenSSL</span><span class='colon2 op'>::</span><span class='rubyid_OCSP constant id'>OCSP</span><span class='colon2 op'>::</span><span class='rubyid_Response constant id'>Response</span><span class='dot token'>.</span><span class='rubyid_create identifier id'>create</span><span class='lparen token'>(</span><span class='rubyid_response_status identifier id'>response_status</span><span class='comma token'>,</span><span class='rubyid_basic_response identifier id'>basic_response</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Tue Dec 27 16:08:50 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.4 (ruby-1.8.7).
</div>

  </body>
</html>